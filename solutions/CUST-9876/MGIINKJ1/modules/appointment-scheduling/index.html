<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agenda de Citas - Clínica Dental Sonrisa Perfecta</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="../../assets/logo.svg" type="image/svg+xml" />
</head>
<body class="bg-gradient-to-r from-teal-400 to-blue-500 min-h-screen text-gray-800">
  <header class="bg-white bg-opacity-80 backdrop-blur-md shadow p-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold text-teal-700">Agenda de Citas</h1>
    <button onclick="history.back()" class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded transition">Volver</button>
  </header>
  <main class="p-8 max-w-4xl mx-auto bg-white bg-opacity-90 rounded-lg shadow-lg">
    <p class="mb-6 text-gray-700">Gestiona y programa las citas con tus pacientes de forma sencilla y rápida.</p>
    <section aria-label="Formulario de nueva cita" class="space-y-6">
      <form id="appointmentForm" class="space-y-4">
        <div>
          <label for="patientName" class="block font-semibold text-gray-700 mb-1">Nombre del paciente</label>
          <input type="text" id="patientName" name="patientName" required class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Ej. Juan Pérez" />
        </div>
        <div>
          <label for="appointmentDate" class="block font-semibold text-gray-700 mb-1">Fecha de la cita</label>
          <input type="date" id="appointmentDate" name="appointmentDate" required class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500" />
        </div>
        <div>
          <label for="appointmentTime" class="block font-semibold text-gray-700 mb-1">Hora de la cita</label>
          <input type="time" id="appointmentTime" name="appointmentTime" required class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500" />
        </div>
        <button type="submit" class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded transition">Guardar cita</button>
      </form>
    </section>
    <section aria-label="Lista de citas programadas" class="mt-10">
      <h2 class="text-xl font-bold text-teal-700 mb-4">Citas programadas</h2>
      <ul id="appointmentsList" class="space-y-3 text-gray-800"></ul>
    </section>
  </main>
  <script>
    const appointmentForm = document.getElementById('appointmentForm');
    const appointmentsList = document.getElementById('appointmentsList');

    function loadAppointments() {
      const stored = localStorage.getItem('appointments') || '[]';
      return JSON.parse(stored);
    }

    function saveAppointments(appointments) {
      localStorage.setItem('appointments', JSON.stringify(appointments));
    }

    function renderAppointments() {
      const appointments = loadAppointments();
      appointmentsList.innerHTML = '';
      if (appointments.length === 0) {
        appointmentsList.innerHTML = '<li class="text-gray-500">No hay citas programadas.</li>';
        return;
      }
      appointments.forEach((appt, index) => {
        const li = document.createElement('li');
        li.className = 'border border-teal-300 rounded p-3 bg-teal-50 flex justify-between items-center';
        li.innerHTML = `
          <div>
            <p><strong>Paciente:</strong> ${appt.patientName}</p>
            <p><strong>Fecha:</strong> ${appt.appointmentDate}</p>
            <p><strong>Hora:</strong> ${appt.appointmentTime}</p>
          </div>
          <button aria-label="Eliminar cita de ${appt.patientName}" data-index="${index}" class="text-red-600 hover:text-red-800 font-bold">&times;</button>
        `;
        appointmentsList.appendChild(li);
      });

      // Add delete handlers
      appointmentsList.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = btn.getAttribute('data-index');
          const appts = loadAppointments();
          appts.splice(idx, 1);
          saveAppointments(appts);
          renderAppointments();
        });
      });
    }

    appointmentForm.addEventListener('submit', e => {
      e.preventDefault();
      const patientName = appointmentForm.patientName.value.trim();
      const appointmentDate = appointmentForm.appointmentDate.value;
      const appointmentTime = appointmentForm.appointmentTime.value;

      if (!patientName || !appointmentDate || !appointmentTime) {
        alert('Por favor complete todos los campos.');
        return;
      }

      const newAppointment = { patientName, appointmentDate, appointmentTime };
      const appointments = loadAppointments();
      appointments.push(newAppointment);
      saveAppointments(appointments);
      renderAppointments();
      appointmentForm.reset();
    });

    renderAppointments();
  </script>

<script>
(function(){
  try{
    const s = JSON.parse(localStorage.getItem('mvp_session')||'null');
    if(!s || !s.user){ location.href = '../../login.html'; }
  }catch(_){ location.href = '../../login.html'; }
})();
</script>
</body>
</html>